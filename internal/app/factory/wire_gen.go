// Code generated by Wire. DO NOT EDIT.

//go:generate wire
//go:build !wireinject
// +build !wireinject

package factory

import (
	"github.com/Justdanru/bhs-test/config"
	"github.com/Justdanru/bhs-test/internal/app"
	"github.com/Justdanru/bhs-test/internal/controller/http/v1/handler"
	"github.com/Justdanru/bhs-test/internal/controller/http/v1/middleware"
	"github.com/Justdanru/bhs-test/internal/controller/http/v1/router"
	"github.com/Justdanru/bhs-test/internal/controller/http/v1/server"
	"github.com/Justdanru/bhs-test/internal/infrastructure/repository/user"
	"github.com/Justdanru/bhs-test/internal/infrastructure/service/auth"
	user2 "github.com/Justdanru/bhs-test/internal/infrastructure/service/user"
)

import (
	_ "github.com/lib/pq"
)

// Injectors from wire.go:

func StartApp() (*app.App, func(), error) {
	configConfig := config.NewConfig()
	errorsHandler := handler.NewErrorsHandler()
	db, cleanup, err := providePostgreSQLConnection(configConfig)
	if err != nil {
		return nil, nil, err
	}
	repositoryPostgreSQL := user.NewRepositoryPostgreSQL(db)
	service := user2.NewService(repositoryPostgreSQL)
	userHandler := handler.NewUserHandler(errorsHandler, service)
	checkUsernameHandler := handler.NewCheckUsernameHandler(errorsHandler, service)
	authService := auth.NewService(configConfig)
	registerHandler := handler.NewRegisterHandler(errorsHandler, service, authService)
	loginHandler := handler.NewLoginHandler(authService, service, errorsHandler)
	rootHandler := handler.NewRootHandler(userHandler, checkUsernameHandler, registerHandler, loginHandler)
	initMiddleware := middleware.NewInitMiddleware()
	authMiddleware := middleware.NewAuthMiddleware(authService)
	rootMiddleware := middleware.NewRootMiddleware(initMiddleware, authMiddleware)
	routerRouter := router.NewRouter(rootHandler, rootMiddleware)
	logger := provideLogger()
	httpServer := server.NewHTTPServer(configConfig, routerRouter, logger)
	appApp, cleanup2, err := startApp(httpServer)
	if err != nil {
		cleanup()
		return nil, nil, err
	}
	return appApp, func() {
		cleanup2()
		cleanup()
	}, nil
}
